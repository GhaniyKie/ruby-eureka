#!/usr/bin/env ruby

require 'eureka'
require 'yaml'
require 'erb'

opts = {}
opts = YAML.load(ERB.new(IO.read('config/eureka_sidecar.yml')).result) || opts

Eureka.setup do |config|
  config.side_app_name = opts.dig('eureka', 'side_app_name')
  config.eureka_url    = opts.dig('eureka', 'url')
end

begin
  exe = Eureka::Execute
  exe.run
rescue => e
  raise e if $DEBUG
  STDERR.puts e.message
  STDERR.puts e.backtrace.join("\n")
  exit 1
end
